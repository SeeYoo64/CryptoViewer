<UserControl x:Class="CryptoViewer.Views.DetailsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:CryptoViewer.Converters"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800">
    <UserControl.Resources>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
        <converters:StringResourceConverter x:Key="StringResourceConverter" />
    </UserControl.Resources>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Tittle -->
        <TextBlock Grid.Row="0" Text="{Binding Coin.Name, StringFormat='Details for {0}'}" Style="{StaticResource MaterialDesignHeadline5TextBlock}" Margin="0,0,0,10" />

        <!-- Error message -->
        <TextBlock Grid.Row="1" Text="{Binding ErrorMessage}" Foreground="Red" Margin="0,0,0,10" Visibility="{Binding ErrorMessage, Converter={StaticResource NullToVisibilityConverter}}" />

        <!-- Coin Details -->
        <materialDesign:Card Grid.Row="2" Padding="10">
            <StackPanel>
                <StackPanel.Resources>
                    <converters:BindingProxy x:Key="proxy" Data="{Binding DataContext}" />
                </StackPanel.Resources>
                <TextBlock Text="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=NameHeader}" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                <TextBlock Text="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=PriceLabelFormat}" />
                <TextBlock Text="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=VolumeLabelFormat}" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                <TextBlock Text="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=Change24hLabelFormat}" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                <TextBlock Text="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=High24hLabelFormat}" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                <TextBlock Text="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=Low24hLabelFormat}" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                <TextBlock Text="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=LastUpdatedLabelFormat}" Style="{StaticResource MaterialDesignBody1TextBlock}" />
                <!-- Markets section with Back button on the same level -->
                <Grid Margin="0,10,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="Markets:" 
                               Style="{StaticResource MaterialDesignSubtitle1TextBlock}" 
                               VerticalAlignment="Center" />
                    <Button Grid.Column="2" Content="{Binding Converter={StaticResource StringResourceConverter}, ConverterParameter=BackButton}" Command="{Binding NavigateBackCommand}" 
                            Style="{StaticResource MaterialDesignRaisedButton}" 
                            Width="100" HorizontalAlignment="Right" />
                </Grid>
                <!-- List of Markets -->
                <DataGrid ItemsSource="{Binding Markets}" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False" 
                          Margin="0,5,0,0" GridLinesVisibility="None" MaxHeight="200" 
                          ScrollViewer.CanContentScroll="True" ScrollViewer.VerticalScrollBarVisibility="Auto">
                    
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=ExchangeHeader}" Binding="{Binding MarketInfo.Name}" Width="2*" />
                        <DataGridTextColumn Header="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=PriceHeader}" Binding="{Binding FormattedLastPrice}" Width="1*" />
                        <DataGridTextColumn  Header="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=VolumeHeader}" Binding="{Binding Volume, StringFormat={}{0:C0}}" Width="1*" />
                        <DataGridTemplateColumn Header="{Binding Data, Source={StaticResource proxy}, Converter={StaticResource StringResourceConverter}, ConverterParameter=TradeHeader}" Width="0.5*">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button Content="{Binding Converter={StaticResource StringResourceConverter}, ConverterParameter=GoButton}" Command="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=DataContext.OpenTradeUrlCommand}" 
                                            CommandParameter="{Binding TradeUrl}" 
                                            Visibility="{Binding TradeUrl, Converter={StaticResource NullToVisibilityConverter}}" 
                                            Style="{StaticResource MaterialDesignRaisedButton}" Width="40" Padding="0" Margin="2,0" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Height" Value="40" />
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>
            </StackPanel>
        </materialDesign:Card>
    </Grid>
</UserControl>